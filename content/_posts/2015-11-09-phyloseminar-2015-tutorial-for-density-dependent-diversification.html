---
author: brianomeara_ra6153
comments: false
date: 2015-11-09 04:14:24+00:00
layout: post
link: http://www.brianomeara.info/2015/11/08/phyloseminar-2015-tutorial-for-density-dependent-diversification/
slug: phyloseminar-2015-tutorial-for-density-dependent-diversification
title: 'Phyloseminar 2015: Tutorial for density dependent diversification'
wordpress_id: 415
categories:
- Phyloseminar
- Teaching
---



<div id="diversitydependent.pdf-diversitydependent.rmd" class="section level1">
<h1><a href="http://brianomeara.info/wordpress_beta/wp-content/uploads/2015/11/diversitydependent.pdf">diversitydependent.pdf</a> <a href="http://www.brianomeara.info/wp-content/uploads/2015/11/diversitydependent.rmd">diversitydependent.Rmd</a></h1>
</div>
<div id="diversity-dependent-diversification-tutorial" class="section level1">
<h1>diversity dependent diversification tutorial</h1>
<div id="rosana-zenil-ferguson" class="section level4">
<h4><em>Rosana Zenil-Ferguson</em></h4>
</div>
<div id="november-8-2015" class="section level4">
<h4><em>November 8, 2015</em></h4>
<pre><code>&lt;code&gt;library(&quot;TreeSim&quot;)&lt;/code&gt;




&lt;code&gt;## Loading required package: ape
## Loading required package: geiger
## Loading required package: laser&lt;/code&gt;




&lt;code&gt;library(&quot;TreePar&quot;)&lt;/code&gt;




&lt;code&gt;## Loading required package: Matrix
## Loading required package: subplex
## Loading required package: deSolve
##
## Attaching package: &#39;deSolve&#39;
##
## The following object is masked from &#39;package:graphics&#39;:
##
##     matplot&lt;/code&gt;</code></pre>
<p>If you have not installed them you should use the function</p>
<pre><code>&lt;code&gt;#install.packages(&quot;nameofthepackage&quot;)&lt;/code&gt;</code></pre>
<p>Tutorial modified from Tanja Stadler’s PhyloDynamics seminar.</p>
</div>
<div id="part-1-density-dependent-diversification-estimates" class="section level3">
<h3>Part 1: Density Dependent Diversification Estimates</h3>
<p>Simulate a tree using <code>TreeSim</code> package. We are assuming that the change in shape of the tree is given by a shift in the diversification rates (like a mass extinction) and not because of diversity dependence (we will test this in the next section). Input for the simulation will be:</p>
<ul>
<li><p>10 extant species</p></li>
<li><p>lambdavect=c(2,0.1), this represents a shift in birthrate</p></li>
<li><p>muvect=c(0,0.05), this represents a shift in extinction rate</p></li>
<li><p>All species are sampled before and after the change in diversification rates</p></li>
<li><p>time=c(0,1) the shift in rate occure 1 unit of time ago (i.e. mya)</p></li>
<li><p>We do not see lineages extinct</p>
<p><code>set.seed(1)
#tree1&lt;-sim.rateshift.taxa()[[1]]</code></p></li>
</ul>
<p>Plot the tree and the lineage through time. Do you notice the “pull of the present”?
Let’s calculate speciation times using the following instruction</p>
<pre><code>&lt;code&gt;#x&lt;-sort(getx(tree1),decreasing=TRUE)&lt;/code&gt;</code></pre>
<p>So now we estimate our density dependent diversification rates. Three parameters are of importance (K, lambda_n, mu) mu is fixed but not zero, lambda_n depends on the number of lineages and K is the carrying capacity. For this part we will use function <code>bd.densdep.optim</code> in <code>TreePar</code> there are faster options in <code>DDD</code> and <code>expoTree</code> (not very intuitive).
What are the input choices for <code>bd.densdep.optim</code>? What would you specify in order to find MLEs?</p>
<pre><code>&lt;code&gt;#res.DDD&lt;-bd.densdep.optim()&lt;/code&gt;</code></pre>
</div>
<div id="part-2-comparing-against-a-model-with-a-shift-in-rates" class="section level3">
<h3>Part 2: Comparing against a model with a shift in rates</h3>
<p>If we want to compare to the model with shifts we can optimize using <code>bd.shifts.optim</code>.</p>
<pre><code>&lt;code&gt;#res.shifts &lt;- bd.shifts.optim(x,c(rho,1),0.1,0.1,2.1)[[2]][[2]]&lt;/code&gt;</code></pre>
<p>How are your estimates for the parameters? What are the potential problems?
To make model comparisons we can calculate AIC values for both models</p>
<pre><code>&lt;code&gt;#aic.ddd &lt;- 2*3+2*res.DDD$value
#aic.shifts &lt;- 2*5+2*res.shifts[1]&lt;/code&gt;</code></pre>
<p>What should be happening given what you simulated?</p>
</div>
<div id="part-3-challenge" class="section level3">
<h3>Part 3: Challenge</h3>
<p>Can you simulate a tree with density dependent diversification? Check the notes of function <code>sim.rateshift.taxa()</code>
Now, fit the density dependent model and the shift dependent model, which one should fit better?</p>
</div>
</div>
